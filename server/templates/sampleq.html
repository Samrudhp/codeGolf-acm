<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fibonacci Series Question</title>
    <style>
        :root {
            --dark-blue: #0d1b2a;
            --medium-blue: #1b263b;
            --light-blue: #415a77;
            --accent-blue: #007bff;
            --white: #f8f9fa;
            --gray: #e0e1dd;
            --rit-red: #F76902;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--dark-blue);
            margin: 0;
            padding: 20px;
            color: var(--white);
            line-height: 1.6;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 15px;
        }
        
        .header-logo {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: 1.2px;
        }
        
        .acm {
            color: var(--white);
            background-color: var(--dark-blue);
            padding: 6px 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .rit {
            color: var(--rit-red);
            margin-left: 6px;
            font-weight: 800;
        }
        
        .container {
            max-width: 1000px;
            width: 90%;
            margin: 30px auto;
            background: var(--medium-blue);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        
        .nav-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: transform 0.2s ease;
        }
        
        .back-link:hover {
            transform: translateX(-3px);
        }
        
        .back-link svg {
            margin-right: 8px;
            fill: currentColor;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 25px;
            color: var(--white);
            border-bottom: 3px solid var(--accent-blue);
            padding-bottom: 12px;
            font-weight: 600;
        }
        
        p {
            font-size: 17px;
            margin-bottom: 22px;
            line-height: 1.7;
        }
        
        code {
            background-color: var(--light-blue);
            padding: 3px 7px;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            font-size: 0.94em;
        }
        
        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 500;
            font-size: 18px;
        }
        
        select {
            padding: 12px 16px;
            font-size: 16px;
            border-radius: 10px;
            background-color: var(--white);
            color: var(--dark-blue);
            border: none;
            margin-bottom: 25px;
            width: 230px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg fill='%230d1b2a' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            font-weight: 500;
        }
        
        textarea {
            width: 100%;
            height: 250px;
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            font-size: 16px;
            margin-top: 12px;
            padding: 20px;
            background-color: var(--white);
            color: var(--dark-blue);
            border: none;
            border-radius: 12px;
            resize: vertical;
            box-shadow: inset 0 3px 10px rgba(0, 0, 0, 0.15);
            line-height: 1.6;
        }
        
        button {
            margin-top: 25px;
            padding: 14px 32px;
            font-size: 17px;
            font-weight: 600;
            color: var(--white);
            background-color: var(--accent-blue);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.25);
        }
        
        button:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .jdoodle-container {
            margin-top: 35px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .sample-case {
            background-color: var(--light-blue);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        
        .sample-case h3 {
            margin-top: 0;
            color: var(--white);
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .sample-case pre {
            background-color: var(--medium-blue);
            padding: 18px;
            border-radius: 8px;
            overflow-x: auto;
            color: var(--white);
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
            margin: 15px 0;
            font-size: 16px;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .nav-button {
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            color: var(--white);
            background-color: var(--accent-blue);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            text-decoration: none;
            display: inline-block;
        }
        
        .nav-button:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.25);
        }
        
        /* Make it responsive */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 25px;
            }
            
            .header-logo {
                font-size: 30px;
            }
            
            h1 {
                font-size: 26px;
            }
            
            textarea {
                height: 200px;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-button {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Existing header and container -->
    <div class="header">
        <div class="header-logo">
            <span class="acm">ACM</span><span class="rit">RIT</span>
        </div>
    </div>
    
    <div class="container">
    <h1 id="questionTitle">Loading...</h1>
    <p id="questionDescription">Please wait while the question details are loaded.</p>
    <div class="sample-case">
        <h3>Sample Input</h3>
        <pre id="sampleInput">Loading...</pre>
        <h3>Sample Output</h3>
        <pre id="sampleOutput">Loading...</pre>
    </div>

    <form id="codeForm">
        <!--
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required 
                pattern="[A-Za-z0-9_]{4,20}" 
                title="4-20 characters (letters, numbers, underscores)">
            </div> 
        -->

        <div class="form-group">
            <label for="usernameDisplay">Username:</label>
            <span id="usernameDisplay" class="username-display">Loading...</span>
            <br/>
            <label for="languageSelect">Select Language:</label>
            <select id="languageSelect" name="language" required>
                <option value="python">Python</option>
                <option value="java">Java</option>
                <option value="c">C</option>
            </select>
        </div>

        <div class="form-group">
            <label for="codeArea">Code:</label>
            <textarea id="codeArea" name="code" 
                      placeholder="Write your code here..." 
                      required spellcheck="false"></textarea>
        </div>

        <button type="submit">Submit Solution</button>
    </form>

    <div id="result" class="result-box"></div>
</div>

    <!-- Integrated Script -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            
            const username = localStorage.getItem('username') || 'Guest';
            document.getElementById('usernameDisplay').textContent = username;
            
            // Get the question ID from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const questionId = urlParams.get('id');
    
            if (!questionId) {
                alert('No question ID provided!');
                return;
            }
    
            let question = null;
    
            try {
                // Fetch the question data from the JSON file
                const response = await fetch('../questions.json'); // Adjust the path if needed
                const questions = await response.json();
    
                // Find the question with the matching ID
                question = questions.find(q => q.id === parseInt(questionId));
                if (!question) {
                    alert('Question not found!');
                    return;
                }
    
                // Populate the page with the question details
                document.title = question.title; // Update the page title
                document.getElementById('questionTitle').textContent = question.title;
                document.getElementById('questionDescription').textContent = question.description;
                document.getElementById('sampleInput').textContent = question.sample_input;
                document.getElementById('sampleOutput').textContent = question.sample_output;
    
            } catch (error) {
                console.error('Error loading question:', error);
            }
    
            // Handle form submission
            const form = document.getElementById('codeForm');
            const resultDiv = document.getElementById('result');
    
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
    
                if (!question) {
                    alert('Question data is not loaded yet!');
                    return;
                }
    
                // Collect form data
                const formData = {
                    username: document.getElementById('username').value,
                    code: document.getElementById('codeArea').value,
                    language: document.getElementById('languageSelect').value,
                    question_id: question.id, // Include the question ID
                    expected_output: question.sample_output // Include the expected output
                };
    
                try {
                    // Send the data to the backend for evaluation
                    const response = await fetch('http://localhost:5000/evaluate_code', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
    
                    const data = await response.json();
    
                    // Display the evaluation results
                    resultDiv.className = data.correct ? 'success' : 'error';
                    resultDiv.innerHTML = data.correct
                        ? `✅ Correct! ${data.message}`
                        : `❌ Error: ${data.message}<br>
                           Your output: ${data.output || 'none'}<br>
                           Expected: ${data.expected}`;
    
                } catch (error) {
                    resultDiv.className = 'error';
                    resultDiv.innerHTML = `🚨 Network Error: ${error.message}`;
                }
            });
        });
    </script>
</body>

</html>